<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Kronroe — embedded temporal property graph database. Try it live in your browser." />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data:; connect-src 'self' ws: wss:; object-src 'none'; base-uri 'self';" />
    <title>Kronroe — Temporal Graph Playground</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
    <script type="module" src="/src/main.ts"></script>
    <style>
      :root {
        --bg:         #060609;
        --surface:    #0c0c14;
        --surface-2:  #111120;
        --border:     #1c1c2e;
        --border-hi:  #2c2c44;
        --lime:       #b4f542;
        --lime-bg:    rgba(180, 245, 66, 0.08);
        --lime-border:rgba(180, 245, 66, 0.2);
        --blue:       #6499ff;
        --blue-bg:    rgba(100, 153, 255, 0.1);
        --blue-border:rgba(100, 153, 255, 0.22);
        --orange:     #ff9f5a;
        --orange-bg:  rgba(255, 159, 90, 0.1);
        --orange-border:rgba(255, 159, 90, 0.22);
        --text:       #dcdcf0;
        --text-mid:   #8888aa;
        --text-dim:   #44445a;
        --green:      #52e88a;
        --red:        #ff5f5f;
        --mono:       "JetBrains Mono", "Cascadia Code", ui-monospace, monospace;
        --display:    "Syne", sans-serif;
      }

      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--display);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      /* Dot-grid texture */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: radial-gradient(circle, #18182e 1px, transparent 1px);
        background-size: 34px 34px;
        pointer-events: none;
        z-index: 0;
      }

      /* Ambient glows */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(ellipse 60% 40% at 15% 15%, rgba(100, 153, 255, 0.04) 0%, transparent 70%),
          radial-gradient(ellipse 50% 40% at 85% 85%, rgba(180, 245, 66, 0.035) 0%, transparent 70%);
        pointer-events: none;
        z-index: 0;
      }

      /* ── Header ── */
      header {
        position: relative;
        z-index: 10;
        height: 52px;
        padding: 0 2.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 0.875rem;
        background: rgba(6, 6, 9, 0.85);
        backdrop-filter: blur(10px);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family: var(--display);
        font-size: 1rem;
        font-weight: 800;
        letter-spacing: -0.025em;
        color: var(--text);
      }

      .logo-mark {
        width: 24px;
        height: 24px;
        border: 1.5px solid var(--lime);
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--mono);
        font-size: 0.6rem;
        font-weight: 700;
        color: var(--lime);
        letter-spacing: 0;
        flex-shrink: 0;
      }

      .badge {
        font-family: var(--mono);
        font-size: 0.6rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        padding: 0.15rem 0.4rem;
        border-radius: 3px;
        background: var(--lime-bg);
        border: 1px solid var(--lime-border);
        color: var(--lime);
      }

      .header-nav {
        margin-left: auto;
        display: flex;
        gap: 2rem;
        font-family: var(--mono);
        font-size: 0.72rem;
        font-weight: 400;
        letter-spacing: 0.02em;
      }

      .header-nav a {
        color: var(--text-mid);
        text-decoration: none;
        transition: color 0.12s;
      }
      .header-nav a:hover { color: var(--text); }

      /* ── Main grid ── */
      main {
        position: relative;
        z-index: 1;
        flex: 1;
        display: grid;
        grid-template-columns: 360px 1fr;
        grid-template-rows: auto 1fr;
        max-width: 1280px;
        width: 100%;
        margin: 0 auto;
        padding: 2.25rem 2.5rem;
        gap: 2rem;
      }

      /* ── Hero ── */
      .hero {
        grid-column: 1 / -1;
      }

      .hero h1 {
        font-family: var(--display);
        font-size: clamp(1.8rem, 3.8vw, 2.9rem);
        font-weight: 800;
        letter-spacing: -0.045em;
        line-height: 1.05;
        margin-bottom: 0.7rem;
      }

      .hero h1 .lime { color: var(--lime); }

      .hero .sub {
        font-family: var(--mono);
        font-size: 0.75rem;
        color: var(--text-dim);
        line-height: 1.65;
        letter-spacing: 0.01em;
        max-width: 480px;
      }

      /* ── Controls column ── */
      .controls {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      /* ── Panel ── */
      .panel {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
      }

      .panel-hdr {
        height: 36px;
        padding: 0 0.875rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 0.45rem;
        font-family: var(--mono);
        font-size: 0.62rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-mid);
      }

      .pip {
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: var(--lime);
        flex-shrink: 0;
      }

      .panel-body {
        padding: 0.875rem;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }

      /* ── Inputs ── */
      .triple {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 0.35rem;
      }

      input, select {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 5px;
        color: var(--text);
        font-family: var(--mono);
        font-size: 0.75rem;
        padding: 0.45rem 0.625rem;
        width: 100%;
        outline: none;
        transition: border-color 0.1s, background 0.1s;
      }

      input:focus, select:focus {
        border-color: rgba(180, 245, 66, 0.5);
        background: rgba(180, 245, 66, 0.015);
      }

      input::placeholder { color: var(--text-dim); }

      select {
        appearance: none;
        cursor: pointer;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' fill='none'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%2344445a' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.5rem center;
        padding-right: 1.6rem;
      }

      select option { background: var(--surface-2); }

      /* datetime-local: hide calendar icon in webkit */
      input[type="datetime-local"]::-webkit-calendar-picker-indicator {
        filter: invert(0.35);
        cursor: pointer;
      }

      /* ── Type-at row (below triple in assert panel) ── */
      .type-at-row {
        display: grid;
        grid-template-columns: auto auto 1fr;
        gap: 0.35rem;
        align-items: center;
      }

      .type-at-row select { width: auto; flex-shrink: 0; }

      /* ── At-label (small annotation for optional timestamp fields) ── */
      .at-hint {
        font-family: var(--mono);
        font-size: 0.6rem;
        color: var(--text-dim);
        letter-spacing: 0.06em;
      }

      /* ── Buttons ── */
      button {
        cursor: pointer;
        font-family: var(--mono);
        font-size: 0.72rem;
        font-weight: 600;
        border: none;
        border-radius: 5px;
        padding: 0.45rem 0.875rem;
        white-space: nowrap;
        transition: all 0.1s;
        letter-spacing: 0.02em;
      }

      .btn-primary {
        background: var(--lime);
        color: #060609;
      }
      .btn-primary:hover { background: #c8ff5c; }
      .btn-primary:active { opacity: 0.88; }

      .btn-ghost {
        background: transparent;
        border: 1px solid var(--border-hi);
        color: var(--text-mid);
      }
      .btn-ghost:hover {
        border-color: var(--text-mid);
        color: var(--text);
      }

      .btn-row {
        display: flex;
        gap: 0.35rem;
      }

      /* ── Example chips ── */
      .chips-label {
        font-family: var(--mono);
        font-size: 0.6rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        color: var(--text-dim);
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.275rem;
      }

      .chip {
        background: transparent;
        border: 1px solid var(--border-hi);
        border-radius: 3px;
        color: var(--text-mid);
        cursor: pointer;
        font-family: var(--mono);
        font-size: 0.62rem;
        font-weight: 400;
        padding: 0.175rem 0.4rem;
        transition: all 0.1s;
      }

      .chip:hover {
        border-color: var(--lime-border);
        color: var(--lime);
        background: var(--lime-bg);
      }

      .chip-demo {
        border-color: var(--lime-border);
        color: var(--lime);
      }

      /* ── Status ── */
      .status {
        font-family: var(--mono);
        font-size: 0.68rem;
        color: var(--text-dim);
        min-height: 1.1rem;
        line-height: 1.4;
      }
      .status.ok  { color: var(--green); }
      .status.err { color: var(--red); }

      /* ── Query row ── */
      .qrow {
        display: flex;
        gap: 0.35rem;
      }
      .qrow input { flex: 1; }

      /* ── Stream panel ── */
      .stream {
        display: flex;
        flex-direction: column;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
      }

      .stream-hdr {
        height: 36px;
        padding: 0 0.875rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-shrink: 0;
      }

      .stream-hdr-left {
        display: flex;
        align-items: center;
        gap: 0.45rem;
        font-family: var(--mono);
        font-size: 0.62rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--text-mid);
      }

      #stream-count {
        color: var(--lime);
        font-weight: 600;
      }

      .stream-hdr-right {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      #stream-mode {
        font-family: var(--mono);
        font-size: 0.6rem;
        font-weight: 500;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        padding: 0.1rem 0.35rem;
        border: 1px solid var(--border-hi);
        border-radius: 3px;
      }

      .btn-export {
        font-family: var(--mono);
        font-size: 0.55rem;
        font-weight: 500;
        letter-spacing: 0.06em;
        color: var(--text-dim);
        background: transparent;
        border: 1px solid var(--border);
        border-radius: 3px;
        padding: 0.1rem 0.4rem;
        cursor: pointer;
        transition: color 0.15s, border-color 0.15s;
      }
      .btn-export:hover {
        color: var(--lime);
        border-color: var(--lime);
      }

      .stream-body {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
        min-height: 460px;
      }

      .stream-body::-webkit-scrollbar { width: 3px; }
      .stream-body::-webkit-scrollbar-thumb { background: var(--border-hi); border-radius: 2px; }
      .stream-body::-webkit-scrollbar-track { background: transparent; }

      /* ── Empty state ── */
      .empty {
        margin: auto;
        text-align: center;
        color: var(--text-dim);
        font-family: var(--mono);
        font-size: 0.72rem;
        line-height: 1.75;
        user-select: none;
      }

      .empty-glyph {
        font-size: 2rem;
        display: block;
        margin-bottom: 0.75rem;
        opacity: 0.3;
        letter-spacing: -0.05em;
      }

      /* ── Fact row ── */
      .fact-row {
        display: grid;
        grid-template-columns: auto auto auto auto 1fr auto auto;
        align-items: center;
        gap: 0.3rem;
        padding: 0.3rem 0.25rem;
        border-bottom: 1px solid rgba(28, 28, 46, 0.7);
        font-family: var(--mono);
        font-size: 0.72rem;
        animation: fact-in 0.18s ease-out both;
      }

      .fact-row.invalidated {
        opacity: 0.35;
      }

      /* ── Invalidate button on fact rows ── */
      .btn-invalidate {
        background: transparent;
        border: none;
        color: var(--text-dim);
        font-size: 0.7rem;
        line-height: 1;
        padding: 0.1rem 0.3rem;
        border-radius: 3px;
        cursor: pointer;
        transition: color 0.1s, background 0.1s;
      }
      .btn-invalidate:hover {
        color: var(--red);
        background: rgba(255, 95, 95, 0.12);
      }
      .btn-invalidate:disabled {
        cursor: default;
        opacity: 0.2;
      }

      .fact-row:last-child { border-bottom: none; }

      .stream-divider {
        font-family: var(--mono);
        font-size: 0.6rem;
        letter-spacing: 0.08em;
        color: var(--red);
        opacity: 0.6;
        padding: 0.5rem 0.75rem 0.3rem;
        border-top: 1px solid color-mix(in srgb, var(--red) 20%, transparent);
        margin-top: 0.15rem;
      }

      @keyframes fact-in {
        from { opacity: 0; transform: translateX(-6px); }
        to   { opacity: 1; transform: translateX(0); }
      }

      .tag {
        font-size: 0.65rem;
        font-weight: 600;
        padding: 0.1rem 0.35rem;
        border-radius: 3px;
        line-height: 1.4;
        white-space: nowrap;
      }

      .tag-s { background: var(--blue-bg);   color: var(--blue);   border: 1px solid var(--blue-border); }
      .tag-p { background: var(--orange-bg); color: var(--orange); border: 1px solid var(--orange-border); }
      .tag-o { background: var(--lime-bg);   color: var(--lime);   border: 1px solid var(--lime-border); }

      .sep {
        color: var(--border-hi);
        font-size: 0.6rem;
        user-select: none;
      }

      .fact-time {
        color: var(--text-dim);
        font-size: 0.6rem;
        white-space: nowrap;
        cursor: default;
      }

      /* ── Bi-temporal timestamp tooltip ── */
      .fact-timestamps {
        position: relative;
        margin-left: auto;
        display: flex;
        align-items: center;
      }

      .fact-ts-tooltip { display: none; } /* hidden data container — shown via #ts-tooltip */

      /* Global fixed tooltip — avoids overflow clipping from stream-body */
      #ts-tooltip {
        position: fixed;
        z-index: 9999;
        background: var(--surface-2);
        border: 1px solid var(--border-hi);
        border-radius: 6px;
        padding: 0.55rem 0.7rem;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.1s;
        min-width: 240px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      }
      #ts-tooltip.visible { opacity: 1; }

      .ts-row {
        display: flex;
        gap: 0.5rem;
        align-items: baseline;
        padding: 0.07rem 0;
      }

      .ts-row-divider {
        margin-top: 0.35rem;
        padding-top: 0.35rem;
        border-top: 1px solid var(--border);
      }

      .ts-key {
        font-family: var(--mono);
        font-size: 0.58rem;
        color: var(--text-dim);
        min-width: 85px;
        flex-shrink: 0;
      }

      .ts-val {
        font-family: var(--mono);
        font-size: 0.58rem;
        color: var(--text-mid);
      }

      .ts-val.ts-active  { color: var(--lime); }
      .ts-val.ts-expired { color: var(--red); }

      /* ── Loading overlay ── */
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: var(--bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1.5rem;
        z-index: 200;
        transition: opacity 0.35s ease;
      }

      .loading-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .loading-wordmark {
        font-family: var(--display);
        font-size: 2rem;
        font-weight: 800;
        letter-spacing: -0.04em;
        color: var(--text);
      }

      .loading-track {
        width: 180px;
        height: 2px;
        background: var(--border);
        border-radius: 1px;
        overflow: hidden;
      }

      .loading-fill {
        height: 100%;
        background: var(--lime);
        border-radius: 1px;
        animation: track 1.4s ease-in-out infinite alternate;
      }

      @keyframes track {
        from { width: 8%;  margin-left: 0; }
        to   { width: 55%; margin-left: 45%; }
      }

      .loading-label {
        font-family: var(--mono);
        font-size: 0.7rem;
        color: var(--text-dim);
        letter-spacing: 0.04em;
      }

      /* ── Footer ── */
      footer {
        position: relative;
        z-index: 1;
        border-top: 1px solid var(--border);
        padding: 0.75rem 2.5rem;
        font-family: var(--mono);
        font-size: 0.67rem;
        color: var(--text-dim);
        display: flex;
        align-items: center;
        gap: 1.5rem;
        background: rgba(6, 6, 9, 0.6);
      }

      footer a { color: var(--text-dim); text-decoration: none; transition: color 0.12s; }
      footer a:hover { color: var(--text-mid); }
      footer .sep { color: var(--border-hi); }

      /* ── Responsive ── */
      @media (max-width: 840px) {
        main {
          grid-template-columns: 1fr;
          padding: 1.5rem 1.25rem;
          gap: 1.25rem;
        }
        .hero { grid-column: 1; }
        .stream-body { min-height: 300px; }
        header { padding: 0 1.25rem; }
        .header-nav { display: none; }
        footer { padding: 0.75rem 1.25rem; gap: 1rem; }
      }
    </style>
  </head>
  <body>

    <!-- Loading -->
    <div class="loading-overlay" id="loading">
      <div class="loading-wordmark">Kronroe</div>
      <div class="loading-track">
        <div class="loading-fill"></div>
      </div>
      <div class="loading-label">initialising wasm engine…</div>
    </div>

    <!-- Header -->
    <header>
      <div class="logo">
        <div class="logo-mark">K</div>
        Kronroe
      </div>
      <div class="badge">WASM</div>
      <nav class="header-nav">
        <a href="https://github.com/kronroe/kronroe" target="_blank" rel="noopener">GitHub</a>
        <a href="https://github.com/kronroe/kronroe#readme" target="_blank" rel="noopener">Docs</a>
        <a href="https://crates.io/crates/kronroe" target="_blank" rel="noopener">crates.io</a>
      </nav>
    </header>

    <!-- Main -->
    <main>
      <section class="hero">
        <h1>Bi-temporal graph.<br><span class="lime">In your browser.</span></h1>
        <p class="sub">// Pure Rust → WebAssembly. Every fact carries four timestamps.<br>// No server. No network. No schema.</p>
      </section>

      <!-- Left: controls -->
      <div class="controls">

        <!-- Assert -->
        <div class="panel">
          <div class="panel-hdr">
            <div class="pip"></div>
            Assert fact
          </div>
          <div class="panel-body">
            <div class="triple">
              <input id="subject"   placeholder="subject" />
              <input id="predicate" placeholder="predicate" />
              <input id="object"    placeholder="value" />
            </div>
            <div class="type-at-row">
              <select id="obj-type" title="Object value type">
                <option value="Text">Text</option>
                <option value="Number">Number</option>
                <option value="Boolean">Boolean</option>
                <option value="Entity">Entity →</option>
              </select>
              <span class="at-hint" title="Bi-temporal tip: set valid_from to record when this was true in the real world.">valid from</span>
              <input type="datetime-local" id="assert-at" title="valid_from — optional. If set, this fact starts being true at that time; leave blank for now." />
            </div>
            <div class="btn-row">
              <button class="btn-primary" id="assert-btn">Assert →</button>
              <button class="btn-ghost"   id="clear-btn" title="Removes all facts from this in-browser graph after confirmation.">Clear graph</button>
            </div>
            <div class="chips-label">TRY</div>
            <div class="chips" id="examples"></div>
            <button class="chip chip-demo" id="time-demo-btn" title="Runs a bi-temporal scenario: assert in the past, retract now, then compare point-in-time query results.">
              Time-travel demo
            </button>
            <div class="status" id="assert-status"></div>
          </div>
        </div>

        <!-- Query -->
        <div class="panel">
          <div class="panel-hdr">
            <div class="pip"></div>
            Query entity
          </div>
          <div class="panel-body">
            <div class="qrow">
              <input id="query-entity" placeholder="entity (e.g. alice)" />
              <button class="btn-primary" id="query-btn">Query →</button>
            </div>
            <div class="qrow">
              <input id="query-pred" placeholder="predicate (optional)" />
              <button class="btn-ghost" id="show-all-btn">Show all</button>
            </div>
            <div class="qrow">
              <input type="datetime-local" id="query-at" title="point in time — leave blank for current facts" />
              <span class="at-hint">at&nbsp;time</span>
            </div>
            <div class="status" id="query-status"></div>
          </div>
        </div>

      </div>

      <!-- Right: fact stream -->
      <div class="stream">
        <div class="stream-hdr">
          <div class="stream-hdr-left">
            <div class="pip"></div>
            Fact stream
            <span id="stream-count">0 facts</span>
          </div>
          <div class="stream-hdr-right">
            <button class="btn-export" id="export-btn" title="Download visible facts as JSON">↓ JSON</button>
            <span id="stream-mode">ALL</span>
          </div>
        </div>
        <div class="stream-body" id="stream-body">
          <div class="empty">
            <span class="empty-glyph">◈</span>
            No facts yet.<br>Assert one above to begin.
          </div>
        </div>
      </div>

    </main>

    <!-- Footer -->
    <footer>
      <span>Kronroe</span>
      <span class="sep">·</span>
      <span>AGPL-3.0 / Commercial</span>
      <span class="sep">·</span>
      <a href="https://github.com/kronroe/kronroe/blob/main/LICENCE-COMMERCIAL.md" target="_blank" rel="noopener">Commercial licence</a>
      <a href="https://github.com/kronroe/kronroe/blob/main/README.md" target="_blank" rel="noopener">Docs</a>
    </footer>

  <div id="ts-tooltip"></div>
  </body>
</html>
